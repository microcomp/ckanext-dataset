{% ckan_extends %}

{% block data_preview %}
        {{ super() }}
        <div class="embedhint" style="padding-left: 15px;">
        	<h4>{{_('Embed this visualisation in your own website...')}}</h4>
        	{{_('Copy the HTML in the box below and you can display this visualisation on your own website.') }}<br />
        	<textarea style="width:97%">&lt;iframe src="{{ request.url }}/preview" frameborder="0" width="100%" height="600px"&gt;&lt;/iframe&gt;</textarea>
        </div>
{% endblock %}

{% block resource_content %}
	{% if res.status=='private' %}
	<span class="dataset-private label label-inverse pull-right">
	<i class="icon-lock"></i>
	{{ _('Private') }}
	</span>
	{% endif %}
	{{ super() }}
{% endblock %}

{% block resource_actions_inner %}
     {% if h.check_access('package_update', {'id':pkg.id }) %}
     	{% if h.package_is_locked(pkg.id) %}
       		<li>{% link_for _('Unlock'), controller='ckanext.edem.dataset_controller:DatasetLockController', action='unlock', id=pkg.id, resource_id=res.id, class_='btn', icon='wrench' %}</li>
       	{% else %}
       		<li>{% link_for _('Manage'), controller='package', action='resource_edit', id=pkg.name, resource_id=res.id, class_='btn', icon='wrench' %}</li>
       	{% endif %}
     {% endif %}
     {% if res.url %}
       <li>
         <a class="btn btn-primary resource-url-analytics resource-type-{{ res.resource_type }}" href="{{ res.url }}">
           {% if res.resource_type in ('listing', 'service') %}
             <i class="icon-eye-open"></i> {{ _('View') }}
           {% elif  res.resource_type == 'api' %}
             <i class="icon-key"></i> {{ _('API Endpoint') }}
           {% elif not res.can_be_previewed %}
             <i class="icon-external-link"></i> {{ _('Go to resource') }}
           {% else %}
             <i class="icon-download"></i> {{ _('Download') }}
           {% endif %}
         </a>
       </li>
     {% endif %}
     {% if 'datastore' in g.plugins %}
       <li>{% snippet 'package/snippets/data_api_button.html', resource=res, datastore_root_url=c.datastore_api %}</li>
     {% endif %}
{% endblock %}
{% block resource_additional_information %}
<div class="module-content">
<h2>{{ _('Additional Information') }}</h2>
<table class="table table-striped table-bordered table-condensed" data-module="table-toggle-more">
<thead>
<tr>
<th scope="col">{{ _('Field') }}</th>
<th scope="col">{{ _('Value') }}</th>
</tr>
</thead>
<tbody>
<tr>
<th scope="row">{{ _('Last updated') }}</th>
<td>{{ h.render_datetime(res.last_modified) or h.render_datetime(res.revision_timestamp) or h.render_datetime(res.created) or _('unknown') }}</td>
</tr>
<tr>
<th scope="row">{{ _('Created') }}</th>
<td>{{ h.render_datetime(res.created) or _('unknown') }}</td>
</tr>
<tr>
<th scope="row">{{ _('Format') }}</th>
<td>{{ res.mimetype_inner or res.mimetype or res.format or _('unknown') }}</td>
</tr>
<tr>
<th scope="row">{{ _('License') }}</th>
<td>{% snippet "snippets/license.html", pkg_dict=pkg, text_only=True %}</td>
</tr>
<tr>
{% set metadata = h.format_resource_items(res.items()) %}
<th scope="row">{{ _('Status')}}</th>
<td>{% if res.status=='public' %} {{_('Public')}} {% else %} {{_('Private')}} {% endif %} </td>
</tr>
{% if res.validity %}
<tr>
<th scope="row">{{ _('Validity')}}</th>
<td>
{% if res.validity=='perm_valid' %}{{_('Valid permanently')}}{% endif %}
{% if res.validity=='custom_valid' %}{{res.validity_description}}{% endif %}
{% if res.validity=='other' %}{{ h.render_datetime(res.valid_from) }} - {{ h.render_datetime(res.valid_to) }}{% endif %}
</td>
</tr>
{% endif %}
{% if res.validity=='other' %}
<tr>
<th scope="row">{{ _('Efficiency')}}</th>
<td>
{{ h.render_datetime(res.active_from) }} - {{ h.render_datetime(res.active_to) }}
</td>
</tr>
{% endif %}
{% if res.periodicity %}
<tr>
<th scope="row">{{ _('Periodicity of actualization')}}</th>
<td>
{% if res.periodicity=='other' %}
	{{ res.periodicity_description}}
{% else%}
	{{ _(res.periodicity) }}
{% endif %}
</td>
</tr>
{% endif %}
{% if res.data_correctness %}
<tr>
<th scope="row">{{ _('Data correctness')}}</th>
<td>
{% if res.data_correctness=='stated in data' %}
	{{ res.data_correctness_description}}
{% else%}
	{{ _(res.data_correctness) }}
{% endif %}
</td>
</tr>
{% endif %}

{% for key, value in  metadata %}
<tr class="toggle-more"><th scope="row">{{ _(key) }}</th><td>{{ _(value) }}</td></tr>
{% endfor %}
</tbody>
</table>
</div>
{% endblock %}
